<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>3-Tier App</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        nav {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
        nav a {
            text-decoration: none;
            color: blue;
            font-weight: bold;
            cursor: pointer;
        }
        section {
            display: none;
        }
        section.active {
            display: block;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        input, button {
            margin: 10px 0;
            padding: 5px;
        }
        .gallery img {
            width: 200px;
            margin: 10px;
        }
    </style>
</head>
<body>
    <h1>3-Tier Web Application</h1>

    <nav>
        <a onclick="showPage('home')">Home</a>
        <a onclick="showPage('images')">Images</a>
        <a onclick="showPage('data')">Data</a>
    </nav>

    <!-- Home Page -->
    <section id="home" class="active">
        <h2>Welcome Home</h2>
        <p>This is the home page of your 3-tier application.</p>
    </section>

    <!-- Images Page -->
    <section id="images">
        <h2>Image Gallery (from S3)</h2>
        <div class="gallery" id="imageGallery">
            <!-- Sample images from S3 -->
            <img src="https://mywebappbucket-04142025pm.s3.amazonaws.com/architecture1.jpg" alt="Image 1">
            <img src="https://mywebappbucket-04142025pm.s3.amazonaws.com/architecture2.jpg" alt="Image 2">
        </div>
    </section>

    <!-- Data Page -->
    <section id="data">
        <h2>User Management</h2>

        <div>
            <h3>Add/Update User</h3>
            <input type="hidden" id="userId" name="userId">
            <input type="text" id="name" placeholder="Name" required>
            <input type="email" id="email" placeholder="Email" required>
            <input type="text" id="phone" placeholder="Phone" required>
            <button onclick="submitUser()">Submit</button>
        </div>

        <div>
            <h3>Users List</h3>
            <table id="userTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Phone</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="userTableBody"></tbody>
            </table>
        </div>
    </section>

    <script>
        const API_URL = '/api';

        // Tab Navigation
        function showPage(pageId) {
            document.querySelectorAll('section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(pageId).classList.add('active');
        }

        // User Management Functions
        async function fetchUsers() {
            try {
                const response = await fetch(`${API_URL}/users`);
                const users = await response.json();
                const tableBody = document.getElementById('userTableBody');
                tableBody.innerHTML = '';
                users.forEach(user => {
                    tableBody.innerHTML += `
                        <tr>
                            <td>${user.id}</td>
                            <td>${user.name}</td>
                            <td>${user.email}</td>
                            <td>${user.phone}</td>
                            <td>
                                <button onclick="editUser(${user.id})">Edit</button>
                                <button onclick="deleteUser(${user.id})">Delete</button>
                            </td>
                        </tr>
                    `;
                });
            } catch (error) {
                console.error('Error fetching users:', error);
                alert('Failed to fetch users');
            }
        }

        async function submitUser() {
            const userId = document.getElementById('userId').value;
            const name = document.getElementById('name').value;
            const email = document.getElementById('email').value;
            const phone = document.getElementById('phone').value;

            try {
                const url = userId ? `${API_URL}/users/${userId}` : `${API_URL}/users`;
                const method = userId ? 'PUT' : 'POST';

                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, email, phone })
                });

                if (response.ok) {
                    fetchUsers();
                    document.getElementById('userId').value = '';
                    document.getElementById('name').value = '';
                    document.getElementById('email').value = '';
                    document.getElementById('phone').value = '';
                } else {
                    alert('Failed to submit user');
                }
            } catch (error) {
                console.error('Error submitting user:', error);
                alert('Failed to submit user');
            }
        }

        async function editUser(id) {
            try {
                const response = await fetch(`${API_URL}/users/${id}`);
                const user = await response.json();
                document.getElementById('userId').value = user.id;
                document.getElementById('name').value = user.name;
                document.getElementById('email').value = user.email;
                document.getElementById('phone').value = user.phone;
            } catch (error) {
                console.error('Error fetching user details:', error);
                alert('Failed to fetch user details');
            }
        }

        async function deleteUser(id) {
            try {
                const response = await fetch(`${API_URL}/users/${id}`, { method: 'DELETE' });
                if (response.ok) {
                    fetchUsers();
                } else {
                    alert('Failed to delete user');
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                alert('Failed to delete user');
            }
        }

        // Initial load
        fetchUsers();
    </script>
</body>
</html>
